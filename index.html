<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Responsys Web Push Demo</title>
  <style>
    body { font-family: Arial, sans-serif; background-color: #f8fafc; color: #333; text-align: center; padding: 40px; }
    h1 { color: #0078d7; }
    .visitor { margin-top: 20px; font-size: 1.2em; }
    input, button { padding: 8px; margin: 10px; font-size: 1em; }
  </style>
</head>
<body>

  <h1>Responsys Web Push Demo</h1>

  <!-- üëá Add this input for your Customer ID -->
  <input type="text" id="customerId" placeholder="Enter Customer ID" />
  <button id="registerBtn">Register</button>

  <p class="visitor" id="visitorIdDisplay">Visitor ID will appear here after registration.</p>

  <!-- Responsys Web Push SDK -->
  <script
    type="text/javascript"
    id="rsyswpsdk"
    src="https://api.pushio.com/webpush/sdk/wpIndex_min.js"
    wpconfig='{
      "appserviceKey": "BBfCgd8DzPawmPJgGJy8decXP1TJvDczsIpA0wqk961Xjb3auyJ9qMC2JwPT6XiRK429JsCDtWRgyLoaujPeGmE=",
      "apiKey": "ABEWBYcAAX3LV04gEHMQJ2xIs",
      "accountToken": "ABElKaqpK-3l_zDeOp-XArlkg",
      "apiHost": "https://abr16c0-webpush.oraclersys.com",
      "appver": "0.0.0",
      "lazy": false
    }'>
  </script>

  <script>
    document.addEventListener("DOMContentLoaded", function () {

      // ‚úÖ Register Service Worker
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('service-worker.js')
          .then(reg => console.log('‚úÖ Service Worker registered:', reg))
          .catch(err => console.error('‚ùå Service Worker registration failed:', err));
      }

      // ‚úÖ Handle Register button click
      document.getElementById("registerBtn").addEventListener("click", function() {
        const customerId = document.getElementById("customerId").value.trim();

        if (!customerId) {
          alert("Please enter your Customer ID first!");
          return;
        }

        const checkSDK = setInterval(() => {
          if (typeof orawp !== "undefined") {
            clearInterval(checkSDK);

            // Register for Web Push
            orawp.registerForWebPush()
              .then(() => {
                const visitorId = orawp.getVisitorId();
                console.log("‚úÖ Visitor ID:", visitorId);
                console.log("üßë Customer ID:", customerId);

                document.getElementById("visitorIdDisplay").textContent =
                  `Customer ID: ${customerId} | Visitor ID: ${visitorId}`;

                // üëâ (optional) send to your DB
                // fetch("https://your-server/save", {
                //   method: "POST",
                //   headers: { "Content-Type": "application/json" },
                //   body: JSON.stringify({ customerId, visitorId })
                // });

              })
              .catch(err => console.error("‚ùå Web Push registration failed:", err));
          }
        }, 500);
      });
    });
  </script>

</body>
</html>
